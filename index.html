<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Streamer.bot Commands</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Streamer.bot Commands</h1>
    <div id="commandSections"></div>
    <p id="errorMessage" class="error"></p>
  </div>

  <script>
    async function loadCommands() {
      const errorEl = document.getElementById('errorMessage');
      try {
        const res = await fetch('commands.json'); // relative path
        if (!res.ok) throw new Error("Failed to fetch commands.json");
        const data = await res.json();

        // Group commands by access level using brackets
        const sections = {
          "Everyone": [],
          "Subs Only": [],
          "VIP Only": [],
          "Mods Only": []
        };

        data.forEach(cmd => {
          const match = cmd.match(/\[(.*)\]$/); // extract [Access] from end
          const access = match ? match[1].trim() : "Everyone";
          const name = match ? cmd.replace(/\[.*\]$/, '').trim() : cmd;
          if (sections[access]) {
            sections[access].push(name);
          } else {
            sections["Everyone"].push(name); // fallback
          }
        });

        const container = document.getElementById('commandSections');
        container.innerHTML = '';

        Object.keys(sections).forEach(access => {
          if (sections[access].length === 0) return;

          const sectionDiv = document.createElement('div');
          sectionDiv.className = 'section';

          const header = document.createElement('h2');
          header.textContent = access;
          sectionDiv.appendChild(header);

          const table = document.createElement('table');
          const thead = document.createElement('thead');
          thead.innerHTML = "<tr><th>Command</th></tr>";
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          sections[access].forEach(name => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${name}</td>`;
            tbody.appendChild(row);
          });
          table.appendChild(tbody);

          sectionDiv.appendChild(table);
          container.appendChild(sectionDiv);
        });

        errorEl.textContent = '';
      } catch (err) {
        console.error("Error loading commands:", err);
        errorEl.textContent = 'Unable to load commands. Please try again later.';
      }
    }

    loadCommands();
    setInterval(loadCommands, 60000); // refresh every 60s
  </script>
</body>
</html>
